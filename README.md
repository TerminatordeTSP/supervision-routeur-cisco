# Router Cisco Supervision - Guide d'installation et d'utilisation

Ce projet permet de surveiller et d'afficher les m√©triques d'un routeur Cisco. Il collecte les donn√©es via Telegraf, les stocke dans InfluxDB et PostgreSQL, et les affiche sur un tableau de bord Django avec interface d'administration.

## üèóÔ∏è Architecture

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   Django App    ‚îÇ‚îÄ‚îÄ‚îÄ‚ñ∂‚îÇ   PostgreSQL    ‚îÇ‚óÄ‚îÄ‚îÄ‚îÄ‚îÇ    pgAdmin      ‚îÇ
‚îÇ   Port: 8080    ‚îÇ    ‚îÇ   Port: 5432    ‚îÇ    ‚îÇ   Port: 5050    ‚îÇ
‚îÇ  (Gunicorn)     ‚îÇ    ‚îÇ  (Base donn√©es) ‚îÇ    ‚îÇ (Administration)‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
        ‚îÇ                       ‚îÇ
        ‚ñº                       ‚îÇ
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê              ‚îÇ
‚îÇ    InfluxDB     ‚îÇ              ‚îÇ
‚îÇ   Port: 8086    ‚îÇ              ‚îÇ
‚îÇ   (M√©triques)   ‚îÇ              ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò              ‚îÇ
        ‚ñ≤                       ‚îÇ
        ‚îÇ                       ‚îÇ
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê              ‚îÇ
‚îÇ    Telegraf     ‚îÇ              ‚îÇ
‚îÇ   Port: 57500   ‚îÇ              ‚îÇ
‚îÇ  (Collecteur)   ‚îÇ              ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò              ‚îÇ
                                ‚îÇ
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê              ‚îÇ
‚îÇ     Caddy       ‚îÇ              ‚îÇ
‚îÇ   Ports: 80/443 ‚îÇ              ‚îÇ
‚îÇ (Reverse Proxy) ‚îÇ              ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

## Modes de d√©ploiement

### 1. **Mode D√©veloppement** (Recommand√© pour tests)
- Docker Compose avec hot-reload
- Base de donn√©es SQLite locale ou PostgreSQL
- Debug activ√©

### 2. **Mode Production** 
- Docker Compose optimis√©
- PostgreSQL obligatoire
- Reverse proxy Caddy
- Logs structur√©s
- Health checks

## Pr√©requis

- **Docker & Docker Compose** (obligatoire)
- **Python 3.9+** (pour d√©veloppement local uniquement)
- **Acc√®s r√©seau** au routeur Cisco √† superviser

## Installation locale rapide

### **Pr√©requis :**
- Docker & Docker Compose install√©s
- Git pour cloner le repository
- Acc√®s r√©seau au routeur Cisco (optionnel pour les tests)

### **Installation en 4 √©tapes :**

1. **Cloner le projet :**
   ```bash
   git clone https://github.com/TerminatordeTSP/supervision-routeur-cisco.git
   cd supervision-routeur-cisco
   ```

2. **D√©marrer tous les services :**
   ```bash
   docker-compose up -d --build
   ```

3. **Attendre que tous les conteneurs soient pr√™ts (30-60 secondes) :**
   ```bash
   docker-compose ps
   ```

4. **[Optionnel] Cr√©er un utilisateur administrateur Django :**
   ```bash
   docker-compose exec router_django python3 router_supervisor/manage.py createsuperuser
   ```

### **Acc√®s aux services :**
- **Application Django** : http://localhost:8080
- **pgAdmin** : http://localhost:5050 
- **InfluxDB** : http://localhost:8086

### **Logins par d√©faut :**

| Service | URL | Login | Mot de passe |
|---------|-----|-------|--------------|
| **Django Admin** | http://localhost:8080/admin/ | admin | projetinfo1A |
| **pgAdmin** | http://localhost:5050 | admin@telecom-sudparis.eu | admin |
| **InfluxDB** | http://localhost:8086 | admin | admin123456 |

> **Note :** Le login Django `admin/projetinfo1A` est configur√© par d√©faut pour toute nouvelle base de donn√©es.

## Roadmap - √âtat du Projet

### **Ce qui fonctionne d√©j√† :**

#### **Infrastructure & D√©ploiement**
- Architecture compl√®te Docker Compose 
- Base de donn√©es PostgreSQL avec pgAdmin
- Base de donn√©es InfluxDB pour m√©triques temporelles
- Reverse proxy Caddy avec SSL automatique
- Health checks et monitoring des conteneurs
- Configuration automatique des services

#### **Collecte et Stockage de Donn√©es**
- Collecteur Telegraf SNMP fonctionnel
- Int√©gration InfluxDB pour m√©triques temporelles
- Pipeline de traitement des donn√©es
- G√©n√©rateur de donn√©es de test pour d√©veloppement
- API REST compl√®te pour acc√®s aux m√©triques

#### **Interface Utilisateur**
- Dashboard Django avec authentification
- Visualisation temps r√©el des m√©triques routeur
- Interface d'administration compl√®te
- Gestion des utilisateurs et permissions
- API REST document√©e

#### **M√©triques Support√©es**
CPU utilization, M√©moire RAM (ratio utilis√©e/libre), Uptime du routeur, Statistiques interfaces r√©seau (trafic, erreurs, statut), tests de connectivit√© ping sur la VM.

#### **üîß Administration**
- Interface d'administration Django avec gestion des seuils d'alerte par utilisateur, configuration des routeurs supervis√©s, logs structur√©s et rotation automatique

### **Ce qu'il reste √† faire :**

#### **Syst√®me d'Alertes Avanc√©**
- Int√©gration de solutions de communication (bas√©es sur Matrix pour rester sur un projet opensource)
- Escalade des alertes selon la criticit√©
- Webhook personnalisables

#### **Visualisations Avanc√©es**
- Graphiques historiques interactifs
- Dashboard personnalisable par utilisateur
- Export de rapports PDF/Excel
- Cartes de chaleur des performances
- Pr√©dictions bas√©es sur l'IA

#### **Fonctionnalit√©s M√©tier**
- Multi-tenancy (gestion de plusieurs clients)
- SLA monitoring et reporting
- Analyse de tendances automatique
- Corr√©lation d'√©v√©nements
- Maintenance planifi√©e

#### **S√©curit√© et Conformit√©**
- Authentification LDAP/Active Directory
- Audit trail complet
- Chiffrement des donn√©es au repos
- Politique de r√©tention avanc√©e
- Conformit√© RGPD compl√®te

#### **Performance et Scalabilit√©**
- Clustering InfluxDB
- Load balancing Django avec Redis
- Optimisation des requ√™tes base de donn√©es
- Cache Redis pour m√©triques fr√©quentes
- Support Kubernetes

#### **Int√©grations**
- API GraphQL en plus de REST
- Int√©gration Grafana native
- Support Prometheus metrics
- Webhook entrants pour √©v√©nements externes
- Int√©gration ITSM (ServiceNow, Jira)

#### **Mobile et Accessibilit√©**
- Application mobile native
- Progressive Web App (PWA)
- Interface accessible (WCAG 2.1)
- Mode hors-ligne partiel


## Installation et D√©ploiement

### **Option A : D√©ploiement Development (Docker Compose)**

1. **Cloner le projet :**
   ```bash
   git clone https://github.com/votre-utilisateur/supervision-routeur-cisco.git
   cd supervision-routeur-cisco
   ```

2. **D√©marrer tous les services :**
   ```bash
   docker-compose up -d --build
   ```

3. **V√©rifier que tous les conteneurs fonctionnent :**
   ```bash
   docker-compose ps
   ```

4. **Cr√©er un superutilisateur Django :**
   ```bash
   docker-compose exec router_django python3 router_supervisor/manage.py createsuperuser
   ```

### **Option B : D√©ploiement Production**

1. **Utiliser la configuration production :**
   ```bash
   cd deployment/
   docker-compose -f docker-compose.prod.yml up -d --build
   ```

2. **Services et ports en production :**
   - **Application Django** : http://localhost:8080
   - **pgAdmin** : http://localhost:5050
   - **InfluxDB** : http://localhost:8086
   - **Caddy (HTTP)** : http://localhost:80
   - **Caddy (HTTPS)** : https://localhost:443

## Base de Donn√©es PostgreSQL

### **Configuration automatique**
L'application d√©tecte automatiquement l'environnement :
- **Docker/Production** : PostgreSQL (si variable `SQL_HOST` pr√©sente)
- **D√©veloppement local** : SQLite (par d√©faut)

### **Param√®tres de connexion PostgreSQL :**
| Param√®tre | Valeur | Description |
|-----------|---------|-------------|
| **Host** | `db` | Nom du service Docker |
| **Port** | `5432` | Port PostgreSQL standard |
| **Database** | `routerdb` | Base de donn√©es principale |
| **Username** | `user` | Utilisateur PostgreSQL |
| **Password** | `password` | Mot de passe (**√Ä changer en production**) |

### **Migrations Django :**
```bash
# Appliquer les migrations
docker-compose exec router_django python3 router_supervisor/manage.py migrate

# Cr√©er de nouvelles migrations (si modification des mod√®les)
docker-compose exec router_django python3 router_supervisor/manage.py makemigrations

# V√©rifier l'√©tat des migrations
docker-compose exec router_django python3 router_supervisor/manage.py showmigrations
```

## Administration avec pgAdmin

### **Acc√®s √† pgAdmin :**
- **URL** : http://localhost:5050
- **Email** : `admin@telecom-sudparis.eu`
- **Mot de passe** : `admin`

### **Configurer la connexion PostgreSQL dans pgAdmin :**

1. **Clic droit sur "Servers" ‚Üí "Register" ‚Üí "Server"**

2. **Onglet "General" :**
   - **Name** : `Router Database`
   - **Description** : `PostgreSQL supervision routeur`

3. **Onglet "Connection" :**
   - **Host name/address** : `db`
   - **Port** : `5432`
   - **Maintenance database** : `routerdb`
   - **Username** : `user`
   - **Password** : `password`
   - **Save password** : Coch√©

## Monitoring et M√©triques

### **InfluxDB (M√©triques temporelles) :**
- **URL** : http://localhost:8086
- **Organisation** : `telecom-sudparis`
- **Bucket** : `router-metrics`
- **Token** : `my-super-secret-auth-token`

### **Telegraf (Collecteur de donn√©es) :**
- **Port d'√©coute** : `57500`
- **Configuration** : `telegraf/telegraf.conf`
- **Processeurs** : `telegraf/processors.conf`
## Tests et Validation

### **V√©rifier la sant√© des services :**
```bash
# Status de tous les conteneurs
docker-compose ps

# Logs d'un service sp√©cifique
docker-compose logs router_django
docker-compose logs postgres
docker-compose logs pgadmin

# Test de connexion PostgreSQL
docker-compose exec router_django python3 router_supervisor/manage.py shell -c "from django.db import connection; connection.ensure_connection(); print('‚úÖ PostgreSQL OK')"

# Test de l'application Django
curl http://localhost:8080/health/
```

### **Commandes de maintenance :**
```bash
# Red√©marrer un service
docker-compose restart router_django

# Reconstruire et red√©marrer
docker-compose up -d --build router_django

# Acc√©der au shell du conteneur
docker-compose exec router_django bash
docker-compose exec postgres psql -U user -d routerdb

# Sauvegarder PostgreSQL
docker-compose exec postgres pg_dump -U user routerdb > backup_$(date +%Y%m%d).sql
```

## Structure du Projet

```
supervision-routeur-cisco/
‚îú‚îÄ‚îÄ üìÑ docker-compose.yml           # Configuration d√©veloppement
‚îú‚îÄ‚îÄ üìÑ Dockerfile                   # Image Django/Python
‚îú‚îÄ‚îÄ üìÑ requirements.txt             # D√©pendances Python
‚îú‚îÄ‚îÄ üìÑ Caddyfile                   # Configuration reverse proxy
‚îú‚îÄ‚îÄ 
‚îú‚îÄ‚îÄ üìÅ router_supervisor/           # Application Django
‚îÇ   ‚îú‚îÄ‚îÄ üìÑ manage.py
‚îÇ   ‚îú‚îÄ‚îÄ üìÑ prod_settings.py        # Settings production
‚îÇ   ‚îú‚îÄ‚îÄ üìÅ src/                    # Configuration Django
‚îÇ   ‚îú‚îÄ‚îÄ üìÅ api_app/                # API REST
‚îÇ   ‚îú‚îÄ‚îÄ üìÅ dashboard_app/          # Interface utilisateur
‚îÇ   ‚îú‚îÄ‚îÄ üìÅ settings_app/           # Param√®tres syst√®me
‚îÇ   ‚îî‚îÄ‚îÄ üìÅ thresholds_app/         # Gestion des seuils
‚îÇ
‚îú‚îÄ‚îÄ üìÅ telegraf/                    # Collecteur de donn√©es
‚îÇ   ‚îú‚îÄ‚îÄ üìÑ telegraf.conf           # Configuration principale
‚îÇ   ‚îú‚îÄ‚îÄ üìÑ processors.conf         # Traitement des donn√©es
‚îÇ   ‚îî‚îÄ‚îÄ üìÅ sample_metrics/         # Donn√©es de test
‚îÇ
‚îú‚îÄ‚îÄ üìÅ deployment/                  # Configuration production
‚îÇ   ‚îî‚îÄ‚îÄ üìÑ docker-compose.prod.yml # Docker Compose production
‚îÇ
‚îî‚îÄ‚îÄ üìÅ logs/                       # Logs applicatifs
```

## Variables d'Environnement

### **Django (router_django) :**
| Variable | Valeur | Description |
|----------|---------|-------------|
| `DATABASE` | `postgres` | Type de base de donn√©es |
| `SQL_HOST` | `db` | Host PostgreSQL |
| `SQL_PORT` | `5432` | Port PostgreSQL |
| `SQL_USER` | `user` | Utilisateur BD |
| `SQL_PASSWORD` | `password` | Mot de passe BD |
| `SQL_DATABASE` | `routerdb` | Nom de la base |
| `DJANGO_SETTINGS_MODULE` | `router_supervisor.prod_settings` | Configuration Django |
| `DEBUG` | `False` | Mode debug (production) |
| `GUNICORN_WORKERS` | `4` | Nombre de workers |

### **PostgreSQL (db) :**
| Variable | Valeur | Description |
|----------|---------|-------------|
| `POSTGRES_USER` | `user` | Utilisateur administrateur |
| `POSTGRES_PASSWORD` | `password` | Mot de passe |
| `POSTGRES_DB` | `routerdb` | Base de donn√©es par d√©faut |

### **pgAdmin :**
| Variable | Valeur | Description |
|----------|---------|-------------|
| `PGADMIN_DEFAULT_EMAIL` | `admin@telecom-sudparis.eu` | Email de connexion |
| `PGADMIN_DEFAULT_PASSWORD` | `admin` | Mot de passe |

### **InfluxDB :**
| Variable | Valeur | Description |
|----------|---------|-------------|
| `DOCKER_INFLUXDB_INIT_USERNAME` | `admin` | Utilisateur admin |
| `DOCKER_INFLUXDB_INIT_PASSWORD` | `admin123456` | Mot de passe |
| `DOCKER_INFLUXDB_INIT_ORG` | `telecom-sudparis` | Organisation |
| `DOCKER_INFLUXDB_INIT_BUCKET` | `router-metrics` | Bucket de donn√©es |
| `DOCKER_INFLUXDB_INIT_ADMIN_TOKEN` | `my-super-secret-auth-token` | Token d'API |

## D√©pannage

### **Probl√®mes courants**

#### **Conteneur PostgreSQL ne d√©marre pas :**
```bash
# V√©rifier les logs
docker-compose logs db

# Supprimer le volume si corruption
docker-compose down -v
docker volume rm supervision-routeur-cisco_pgdata
docker-compose up -d db
```

#### **Erreur de connexion pgAdmin ‚Üí PostgreSQL :**
- Utiliser `db` comme host (pas `localhost`)
- Port `5432` (pas `5050`)
- V√©rifier que les conteneurs sont sur le m√™me r√©seau

#### **Django ne se connecte pas √† PostgreSQL :**
```bash
# V√©rifier les variables d'environnement
docker-compose exec router_django env | grep SQL

# Tester la connexion manuellement
docker-compose exec router_django python3 -c "
import psycopg2
conn = psycopg2.connect(host='db', port=5432, user='user', password='password', dbname='routerdb')
print('‚úÖ Connexion PostgreSQL r√©ussie')
"
```

#### **Probl√®me de permissions sur les volumes :**
```bash
# Linux/Mac - Ajuster les permissions
sudo chown -R $USER:$USER ./logs
sudo chown -R $USER:$USER ./telegraf/sample_metrics

# Windows - Red√©marrer Docker Desktop
```

#### **Erreurs de migration Django :**
```bash
# Reset complet des migrations (‚ö†Ô∏è Perte de donn√©es)
docker-compose exec router_django python3 router_supervisor/manage.py migrate --fake-initial
docker-compose exec router_django python3 router_supervisor/manage.py migrate
```

### **Commandes de diagnostic :**
```bash
# Sant√© g√©n√©rale du syst√®me
docker system df
docker system prune

# R√©seaux Docker
docker network ls
docker network inspect supervision-routeur-cisco_default

# Volumes persistants
docker volume ls
docker volume inspect supervision-routeur-cisco_pgdata
```

## S√©curit√© en Production

### **‚ö†Ô∏è √Ä MODIFIER AVANT LA PRODUCTION :**

1. **Mots de passe par d√©faut :**
   ```bash
   # PostgreSQL
   POSTGRES_PASSWORD: VotreMotDePasseSecurise123!
   
   # pgAdmin
   PGADMIN_DEFAULT_PASSWORD: AdminSecurise456!
   
   # InfluxDB
   DOCKER_INFLUXDB_INIT_PASSWORD: InfluxSecurise789!
   ```

2. **Certificats SSL/TLS :**
   - Configurer Caddy avec des certificats valides
   - D√©sactiver HTTP en production (HTTPS uniquement)

3. **Firewall et acc√®s r√©seau :**
   ```bash
   # Limiter l'acc√®s aux ports sensibles
   # pgAdmin (5050) : Acc√®s interne uniquement
   # PostgreSQL (5432) : Pas d'exposition publique
   ```

## Ressources Suppl√©mentaires

### **Documentation technique :**
- [Django Documentation](https://docs.djangoproject.com/)
- [PostgreSQL Manual](https://www.postgresql.org/docs/)
- [Docker Compose Reference](https://docs.docker.com/compose/)
- [InfluxDB Documentation](https://docs.influxdata.com/)
- [Telegraf Documentation](https://docs.influxdata.com/telegraf/)

### **Monitoring et logs :**
```bash
# Surveiller les ressources
docker stats

# Logs en temps r√©el
docker-compose logs -f router_django

# Analyser l'utilisation disque
docker system df -v
```

## üìù Changelog PostgreSQL

### **Version 2.0 - Migration PostgreSQL** ‚úÖ
- ‚úÖ Migration SQLite ‚Üí PostgreSQL
- ‚úÖ Configuration Docker Compose automatis√©e  
- ‚úÖ Interface pgAdmin int√©gr√©e
- ‚úÖ D√©tection automatique d'environnement
- ‚úÖ Volumes persistants pour les donn√©es
- ‚úÖ Health checks et logging structur√©
- ‚úÖ Configuration production s√©par√©e

### **Avantages obtenus :**
- üöÄ **Performance** : PostgreSQL plus rapide que SQLite
- üîÑ **Concurrence** : Support multi-utilisateurs
- üìà **Scalabilit√©** : Gestion de grandes quantit√©s de donn√©es
- üõ°Ô∏è **Fiabilit√©** : Transactions ACID, backup/restore
- üîß **Administration** : Interface pgAdmin int√©gr√©e

## üìÑ Licence

Ce projet est sous licence [MIT](https://mit-license.org/).

---

**D√©velopp√© par le groupe 4 des FISA LIMA Telecom SudParis** üéì  
**Version:** 2.0 - PostgreSQL Edition  
**Derni√®re mise √† jour:** Juillet 2025
