{% extends 'base.html' %}
{% block content %}
<style>
    :root {
        --main-orange: #ff7300;  /* CHANGE THIS if you want a different orange */
    }
    body {
        background-color: #1A1111 !important;
    }
    .dashboard-container {
        margin: 20px;
        color: #fff;
        font-family: 'Segoe UI', Arial, sans-serif;
    }
    h2, .main-title, .router-info > span {
        color: var(--main-orange) !important;
        margin-bottom: 16px;
        font-size: 2em;
        font-weight: bold;
    }
    .top-cards, .mid-cards {
        display: flex;
        gap: 20px;
        margin-bottom: 10px;
    }
    .card {
        background: #2b1815;
        border-radius: 10px;
        padding: 22px 0;
        flex: 1;
        text-align: center;
        box-shadow: 0 2px 8px rgba(0,0,0,0.18);
        margin: 0 0 0 0;
    }
    .card span {
        display: block;
    }
    .big-number {
        font-size: 2.2em;
        font-weight: bold;
        margin: 8px 0 0 0;
        color: var(--main-orange);
    }
    .unit {
        color: var(--main-orange);
        font-size: 1em;
    }
    .charts-row {
        display: flex;
        gap: 20px;
        margin: 20px 0 0 0;
    }
    .chart-card {
        background: #2b1815;
        border-radius: 10px;
        flex: 1;
        padding: 18px 25px;
        color: #fff;
        min-width: 180px;
    }
    .chart-card span {
        display: block;
    }
    .bar-bg {
        background: #211313;
        height: 9px;
        border-radius: 7px;
        margin-top: 9px;
        margin-bottom: 6px;
        width: 100%;
    }
    .bar {
        background: var(--main-orange);
        height: 9px;
        border-radius: 7px;
        transition: width 0.6s;
    }
    .router-info {
        margin-top: 30px;
        background: #2b1815;
        border-radius: 10px;
        padding: 18px;
    }
    .router-info > span {
        color: var(--main-orange) !important;
        font-size: 1.05em;
        font-weight: bold;
    }
    .router-details {
        margin-top: 10px;
        background: #1a1111;
        padding: 10px 12px;
        border-radius: 6px;
        color: #fff;
        border: 1px solid #424242;
        font-size: 1em;
    }
    /* HEADER BUTTONS STYLE */
    .header-buttons {
        position: absolute;
        right: 38px;
        top: 28px;
        display: flex;
        gap: 12px;
    }
    .header-btn {
        background: none;
        border: 1.5px solid var(--main-orange);
        color: var(--main-orange);
        padding: 6px 16px;
        border-radius: 8px;
        font-size: 1.07em;
        cursor: pointer;
        transition: background 0.2s, color 0.2s;
        text-decoration: none;
        font-weight: 600;
    }
    .header-btn:hover {
        background: var(--main-orange);
        color: #1A1111;
    }
    @media (max-width: 900px) {
        .top-cards, .mid-cards, .charts-row {
            flex-direction: column;
        }
        .header-buttons {
            position: static;
            margin-bottom: 15px;
        }
    }
</style>

<div style="display: flex; align-items: center; justify-content: space-between;">
    <h2 class="main-title">Welcome to the Dashboard</h2>
    <div class="header-buttons">
        <a class="header-btn" href="/alerts/">Alerts</a>
        <a class="header-btn" href="/thresholds/">Thresholds</a>
        <a class="header-btn" href="/settings/">Param√®tres</a>
        <a class="header-btn" href="/logout/">Logout</a>
    </div>
</div>

<div class="dashboard-container">
    <div class="top-cards">
        <div class="card">
            <span>ROUTER CPU</span>
            <span class="big-number" id="router_cpu">0</span> <span class="unit">%</span>
        </div>
        <div class="card">
            <span>ROUTER UPTIME</span>
            <span class="big-number" id="router_uptime">0</span> <span class="unit">h</span>
        </div>
        <div class="card">
            <span>SYSTEM CPU</span>
            <span class="big-number" id="system_cpu">0</span> <span class="unit">%</span>
        </div>
    </div>
    <div class="mid-cards">
        <div class="card">
            <span>LATENCY</span>
            <span class="big-number" id="latency">0</span> <span class="unit">ms</span>
        </div>
        <div class="card">
            <span>SYSTEM LOAD</span>
            <span class="big-number" id="system_load">0</span>
        </div>
        <div class="card">
            <span>RAM USAGE</span>
            <span class="big-number" id="ram_usage">0</span> <span class="unit">%</span>
        </div>
    </div>
    <div class="charts-row">
        <div class="chart-card">
            <span>Router CPU Usage</span>
            <span id="router_cpu_bar">0%</span>
            <div class="bar-bg">
                <div class="bar" id="router_cpu_progress" style="width: 0%;"></div>
            </div>
        </div>
        <div class="chart-card">
            <span>Memory Usage</span>
            <span id="memory_usage_bar">0%</span>
            <div class="bar-bg">
                <div class="bar" id="memory_usage_progress" style="width: 0%;"></div>
            </div>
        </div>
        <div class="chart-card">
            <span>Network Latency</span>
            <span id="latency_bar">0 ms</span>
            <div class="bar-bg">
                <div class="bar" id="latency_progress" style="width: 0%;"></div>
            </div>
        </div>
    </div>
    <div class="router-info">
        <span>Router Information</span>
        <div class="router-details">
            <span>
                <b>Router Name:</b> <span id="router_name"></span>
                <b>Last Updated:</b> <span id="last_updated"></span>
            </span>
        </div>
    </div>
</div>

<script>
function fetchMetrics() {
    fetch('/api/latest_metrics/')
        .then(response => response.json())
        .then(data => {
            let cpu = data.find(x => x.field === "cpu_0_usage");
            let ram = data.find(x => x.field === "used_percent" || x.field === "ram_used");
            let latency = data.find(x => x.field === "latency_ms");
            let uptime = data.find(x => x.field === "uptime");
            let sys_cpu = data.find(x => x.field === "usage_system");
            let sys_load = data.find(x => x.field === "load1");

            document.getElementById('router_cpu').textContent = cpu ? cpu.value : "0";
            document.getElementById('system_cpu').textContent = sys_cpu ? sys_cpu.value : "0";
            document.getElementById('system_load').textContent = sys_load ? sys_load.value : "0";
            document.getElementById('latency').textContent = latency ? latency.value : "0";
            document.getElementById('ram_usage').textContent = ram ? ram.value : "0";
            document.getElementById('router_uptime').textContent = uptime ? (uptime.value / 3600).toFixed(2) : "0";

            document.getElementById('router_cpu_bar').textContent = cpu ? cpu.value + "%" : "0%";
            document.getElementById('memory_usage_bar').textContent = ram ? ram.value + "%" : "0%";
            document.getElementById('latency_bar').textContent = latency ? latency.value + " ms" : "0 ms";
            document.getElementById('router_cpu_progress').style.width = cpu ? (cpu.value || 0) + "%" : "0%";
            document.getElementById('memory_usage_progress').style.width = ram ? (ram.value || 0) + "%" : "0%";
            document.getElementById('latency_progress').style.width = latency ? Math.min((latency.value || 0) / 10, 100) + "%" : "0%";

            if (cpu && cpu.tags && cpu.tags.hostname) {
                document.getElementById('router_name').textContent = cpu.tags.hostname;
            } else {
                document.getElementById('router_name').textContent = '';
            }

            if (cpu && cpu.time) {
                document.getElementById('last_updated').textContent = cpu.time.replace("T", " ").replace("Z", "");
            } else {
                document.getElementById('last_updated').textContent = '';
            }
        });
}

setInterval(fetchMetrics, 5000);
fetchMetrics();
</script>
{% endblock %}